{
  "version": 3,
  "sources": ["../../node_modules/markdown-it-html5-media/lib/index.js"],
  "sourcesContent": ["'use strict';\n/* eslint complexity: \"off\" */\n\n\n/**\n * A minimalist `markdown-it` plugin for parsing video/audio references inside\n * markdown image syntax as `<video>` / `<audio>` tags.\n *\n * @namespace HTML5Media\n */\n\n// We can only detect video/audio files from the extension in the URL.\n// We ignore MP1 and MP2 (not in active use) and default to video for ambiguous\n// extensions (MPG, MP4)\nconst validAudioExtensions = ['aac', 'm4a', 'mp3', 'oga', 'ogg', 'wav'];\nconst validVideoExtensions = ['mp4', 'm4v', 'ogv', 'webm', 'mpg', 'mpeg'];\n\n/**\n * @property {Object} messages\n * @property {Object} messages.languageCode\n *  a set of messages identified with a language code, typically an ISO639 code\n * @property {String} messages.languageCode.messageKey\n *  an individual translation of a message to that language, identified with a\n *  message key\n * @typedef {Object} MessagesObj\n */\nlet messages = {\n  en: {\n    'html5 video not supported': 'Your browser does not support playing HTML5 video.',\n    'html5 audio not supported': 'Your browser does not support playing HTML5 audio.',\n    'html5 media fallback link': 'You can <a href=\"%s\" download>download the file</a> instead.',\n    'html5 media description': 'Here is a description of the content: %s'\n  }\n};\n\n/**\n * You can override this function using options.translateFn.\n *\n * @param {String} language\n *  a language code, typically an ISO 639-[1-3] code.\n * @param {String} messageKey\n *  an identifier for the message, typically a short descriptive text\n * @param {String[]} messageParams\n *  Strings to be substituted into the message using some pattern, e.g., %s or\n *  %1$s, %2$s. By default we only use a simple %s pattern.\n * @returns {String}\n *  the translation to use\n * @memberof HTML5Media\n */\nlet translate = function(language, messageKey, messageParams) {\n\n  // Revert back to English default if no message object, or no translation\n  // for this language\n  if (!messages[language] || !messages[language][messageKey])\n    language = 'en';\n\n  if (!messages[language])\n    return '';\n\n  let message = messages[language][messageKey] || '';\n\n  if (messageParams)\n    for (let param of messageParams)\n      message = message.replace('%s', param);\n\n  return message;\n};\n\n\n/**\n * A fork of the built-in image tokenizer which guesses video/audio files based\n * on their extension, and tokenizes them accordingly.\n *\n * @param {Object} state\n *  Markdown-It state\n * @param {Boolean} silent\n *  if true, only validate, don't tokenize\n * @param {MarkdownIt} md\n *  instance of Markdown-It used for utility functions\n * @returns {Boolean}\n * @memberof HTML5Media\n */\nfunction tokenizeImagesAndMedia(state, silent, md) {\n  let attrs, code, content, label, labelEnd, labelStart, pos, ref, res, title,\n    token, tokens, start;\n  let href = '',\n    oldPos = state.pos,\n    max = state.posMax;\n\n  // Exclamation mark followed by open square bracket - ![ - otherwise abort\n  if (state.src.charCodeAt(state.pos) !== 0x21 ||\n    state.src.charCodeAt(state.pos + 1) !== 0x5B)\n    return false;\n\n  labelStart = state.pos + 2;\n  labelEnd = state.md.helpers.parseLinkLabel(state, state.pos + 1, false);\n\n  // Parser failed to find ']', so it's not a valid link\n  if (labelEnd < 0)\n    return false;\n\n  pos = labelEnd + 1;\n  if (pos < max && state.src.charCodeAt(pos) === 0x28) { // Parenthesis: (\n    //\n    // Inline link\n    //\n\n    // [link](  <href>  \"title\"  )\n    //        ^^ skipping these spaces\n    pos++;\n    for (; pos < max; pos++) {\n      code = state.src.charCodeAt(pos);\n      if (!md.utils.isSpace(code) && code !== 0x0A) // LF \\n\n        break;\n    }\n    if (pos >= max)\n      return false;\n\n    // [link](  <href>  \"title\"  )\n    //          ^^^^^^ parsing link destination\n    start = pos;\n    res = state.md.helpers.parseLinkDestination(state.src, pos, state.posMax);\n    if (res.ok) {\n      href = state.md.normalizeLink(res.str);\n      if (state.md.validateLink(href)) {\n        pos = res.pos;\n      } else {\n        href = '';\n      }\n    }\n\n    // [link](  <href>  \"title\"  )\n    //                ^^ skipping these spaces\n    start = pos;\n    for (; pos < max; pos++) {\n      code = state.src.charCodeAt(pos);\n      if (!md.utils.isSpace(code) && code !== 0x0A)\n        break;\n    }\n\n    // [link](  <href>  \"title\"  )\n    //                  ^^^^^^^ parsing link title\n    res = state.md.helpers.parseLinkTitle(state.src, pos, state.posMax);\n    if (pos < max && start !== pos && res.ok) {\n      title = res.str;\n      pos = res.pos;\n\n      // [link](  <href>  \"title\"  )\n      //                         ^^ skipping these spaces\n      for (; pos < max; pos++) {\n        code = state.src.charCodeAt(pos);\n        if (!md.utils.isSpace(code) && code !== 0x0A)\n          break;\n      }\n    } else {\n      title = '';\n    }\n\n    if (pos >= max || state.src.charCodeAt(pos) !== 0x29) { // Parenthesis: )\n      state.pos = oldPos;\n      return false;\n    }\n    pos++;\n  } else {\n    //\n    // Link reference\n    //\n    if (typeof state.env.references === 'undefined')\n      return false;\n\n    if (pos < max && state.src.charCodeAt(pos) === 0x5B) { // Bracket: [\n      start = pos + 1;\n      pos = state.md.helpers.parseLinkLabel(state, pos);\n      if (pos >= 0) {\n        label = state.src.slice(start, pos++);\n      } else {\n        pos = labelEnd + 1;\n      }\n    } else {\n      pos = labelEnd + 1;\n    }\n\n    // covers label === '' and label === undefined\n    // (collapsed reference link and shortcut reference link respectively)\n    if (!label)\n      label = state.src.slice(labelStart, labelEnd);\n\n    ref = state.env.references[md.utils.normalizeReference(label)];\n    if (!ref) {\n      state.pos = oldPos;\n      return false;\n    }\n    href = ref.href;\n    title = ref.title;\n  }\n\n  state.pos = pos;\n  state.posMax = max;\n\n  if (silent)\n    return true;\n\n  // We found the end of the link, and know for a fact it's a valid link;\n  // so all that's left to do is to call tokenizer.\n  content = state.src.slice(labelStart, labelEnd);\n\n  state.md.inline.parse(\n    content,\n    state.md,\n    state.env,\n    tokens = []\n  );\n\n  const mediaType = guessMediaType(href);\n  const tag = mediaType == 'image' ? 'img' : mediaType;\n\n  token = state.push(mediaType, tag, 0);\n  token.attrs = attrs = [\n    ['src', href]\n  ];\n  if (mediaType == 'image')\n    attrs.push(['alt', '']);\n  token.children = tokens;\n  token.content = content;\n\n  if (title)\n    attrs.push(['title', title]);\n\n  state.pos = pos;\n  state.posMax = max;\n  return true;\n\n}\n\n\n/**\n * Guess the media type represented by a URL based on the file extension,\n * if any\n *\n * @param {String} url\n *  any valid URL\n * @returns {String}\n *  a type identifier: 'image' (default for all unrecognized URLs), 'audio'\n *  or 'video'\n * @memberof HTML5Media\n */\nfunction guessMediaType(url) {\n  const extensionMatch = url.match(/\\.([^/.]+)$/);\n  if (extensionMatch === null)\n    return 'image';\n  const extension = extensionMatch[1];\n  if (validAudioExtensions.indexOf(extension.toLowerCase()) != -1)\n    return 'audio';\n  else if (validVideoExtensions.indexOf(extension.toLowerCase()) != -1)\n    return 'video';\n  else\n    return 'image';\n}\n\n\n/**\n * Render tokens of the video/audio type to HTML5 tags\n *\n * @param {Object} tokens\n *  token stream\n * @param {Number} idx\n *  which token are we rendering\n * @param {Object} options\n *  Markdown-It options, including this plugin's settings\n * @param {Object} env\n *  Markdown-It environment, potentially including language setting\n * @param {MarkdownIt} md\n *  instance used for utilities access\n * @returns {String}\n *  rendered token\n * @memberof HTML5Media\n */\nfunction renderMedia(tokens, idx, options, env, md) {\n  const token = tokens[idx];\n  const type = token.type;\n  if (type !== 'video' && type !== 'audio')\n    return '';\n  let attrs = options.html5Media[`${type}Attrs`].trim();\n  if (attrs)\n    attrs = ' ' + attrs;\n\n  // We'll always have a URL for non-image media: they are detected by URL\n  const url = token.attrs[token.attrIndex('src')][1];\n\n  // Title is set like this: ![descriptive text](video.mp4 \"title\")\n  const title = token.attrIndex('title') != -1 ?\n    ` title=\"${md.utils.escapeHtml(token.attrs[token.attrIndex('title')][1])}\"` :\n    '';\n\n  const fallbackText =\n    translate(env.language, `html5 ${type} not supported`) + '\\n' +\n    translate(env.language, 'html5 media fallback link', [url]);\n\n  const description = token.content ?\n    '\\n' + translate(env.language, 'html5 media description', [md.utils.escapeHtml(token.content)]) :\n    '';\n\n  return `<${type} src=\"${url}\"${title}${attrs}>\\n` +\n    `${fallbackText}${description}\\n` +\n    `</${type}>`;\n}\n\n\n/**\n * The main plugin function, exported as module.exports\n *\n * @param {MarkdownIt} md\n *  instance, automatically passed by md.use\n * @param {Object} [options]\n *  configuration\n * @param {String} [options.videoAttrs='controls class=\"html5-video-player\"']\n *  attributes to include inside `<video>` tags\n * @param {String} [options.audioAttrs='controls class=\"html5-audio-player\"']\n *  attributes to include inside `<audio>` tags\n * @param {MessagesObj} [options.messages=built-in messages]\n *  human-readable text that is part of the output\n * @memberof HTML5Media\n */\nfunction html5Media(md, options = {}) {\n  if (options.messages)\n    messages = options.messages;\n  if (options.translateFn)\n    translate = options.translateFn;\n\n  const videoAttrs = options.videoAttrs !== undefined ?\n    options.videoAttrs :\n    'controls class=\"html5-video-player\"';\n  const audioAttrs = options.audioAttrs !== undefined ?\n    options.audioAttrs :\n    'controls class=\"html5-audio-player\"';\n\n  md.inline.ruler.at('image', (tokens, silent) => tokenizeImagesAndMedia(tokens, silent, md));\n\n  md.renderer.rules.video = md.renderer.rules.audio =\n    (tokens, idx, opt, env) => {\n      opt.html5Media = {\n        videoAttrs,\n        audioAttrs\n      };\n      return renderMedia(tokens, idx, opt, env, md);\n    };\n}\n\nmodule.exports = {\n  html5Media,\n  messages, // For partial customization of messages\n  guessMediaType\n};\n"],
  "mappings": "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",
  "names": []
}
